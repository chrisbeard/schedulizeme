<!DOCTYPE html>

<!--
CREDITS
- Calendar icon downloaded from https://www.iconfinder.com, used under Creative Commons.
- jCanvas from http://calebevans.me/, licensed under the MIT license.
-->

<html lang="en">
<head>
	<meta charset="utf-8">

	<title>Schedulize Me</title>
	<meta name="description" content="Schedulize Me - an interactive class scheduler for students.">
	<meta name="author" content="">

	<link href='http://fonts.googleapis.com/css?family=Open+Sans:400,300' rel='stylesheet' type='text/css'>
	<script src="http://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>

	<meta name="viewport" content="width=device-width, initial-scale=1">

	<link rel="stylesheet" href="bootstrap/css/bootstrap.min.css">
	<link rel="stylesheet" href="bootstrap/css/bootstrap-theme.min.css">
	<script src="bootstrap/js/bootstrap.min.js"></script>
	<link rel="stylesheet" href="css/main.css">

	<!--[if lt IE 9]>
	<script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
	<![endif]-->
	
</head>

<body>

	<header class="header clearfix">
		<h1 class="title"><img src="icon.png" style="width:2%; height:2%; padding-bottom:10px; -webkit-filter: invert(100%); "/> Schedulize Me</h1>
	</header>
	<section class="sidebar">

		<div class="spacer"></div>

			<h2>Build your schedule.</h2>
			<div class="styled-select">
				<select id="selectDept" class="course-nav">
				</select>
			</div>
			<div class="styled-select">
				<select id="selectCourse" class="course-nav" selected="Course">
				</select>
			</div>
			<div class="styled-select">
				<select id="selectSection" class="course-nav">
				</select>
			</div>
			<div class="styled-select">
				<select id="selectLab" class="course-nav">
				</select>
			</div>
			<a href="#" class="btn btn-info" id="submitButton"><i class="icon-white icon-plus"></i>Add</a>

			<button type="button" class="btn btn-danger btn-small button-clear" onclick="clearEverything()">Clear Selections</button>
	</section>

	<!-- cookie prep -->
	<script type="text/javascript">
	var fullList=[];

	//check if cookie exists
	function readCookie(name) {
		var nameEQ = name + "=";
		var ca = document.cookie.split(';');
		for(var i=0;i < ca.length;i++) {
			var c = ca[i];
			while (c.charAt(0)==' ') c = c.substring(1,c.length);
			if (c.indexOf(nameEQ) == 0) return c.substring(nameEQ.length,c.length);
		}
		return null; }

	var cookieInput = readCookie("CRNs");

	</script>

	<!-- Cookie functions -->
	<script type="text/javascript">
	function cookieAdd(crn) {
		fullList.push(crn);
		document.cookie="CRNs=" + fullList;
		console.log(document.cookie);
	}

/*
	// Original JavaScript code by Chirp Internet: www.chirp.com.au
	// Please acknowledge use of this code by including this header.
	function getCookie(name)
	{
		 var re = new RegExp(name + "=([^;]+)");
	         var value = re.exec(document.cookie);
		 return (value != null) ? unescape(value[1]) : null;
	}

		var CRNs=[62345, 12345, 12345];
		var jsonCRNs=JSON.stringify(CRNs);
		document.cookie="CRNs=" + jsonCRNs; //can also be just +CRNs
		console.log(document.cookie);

		console.log(getCookie("CRNs"));
*/
		</script>
	
	<!-- Clear selected courses -->
	<script type="text/javascript">
		function clearEverything() {
			$('canvas').removeLayerGroup("courses").drawLayers();

			// Not going to reset the search fields
			// $('#selectCourse').css('visibility', 'hidden');
			// $('#selectSection').css('visibility', 'hidden');
			// $('#submitButton').css('visibility', 'hidden');
			// $('#selectLab').css('display', 'none');
			// $('#selectCourse').empty();
			// $('#selectSection').empty();
			// $('#selectLab').empty();
		}
	</script>

	<!-- Populate department list -->  
	<script type="text/javascript">
		$.get('http://trump6.com/schedulizeme/api/dept.php', function(data) {
			$('#selectCourse').css('visibility', 'hidden');
			$('#selectSection').css('visibility', 'hidden');
			$('#submitButton').css('visibility', 'hidden');
			$('#selectLab').css('display', 'none');
			$('#selectCourse').empty();
			$('#selectSection').empty();
			$('#selectLab').empty();
			var depts = JSON.parse(data);
			var select = document.getElementById("selectDept");
			var firstElement = document.createElement("option");
			firstElement.textContent = "Choose Department";
			firstElement.value = "";
			$(firstElement).attr('selected', 'selected');
			$(firstElement).attr('disabled', 'disabled');
			select.appendChild(firstElement);
			for(var i = 0; i < depts.length; i++) {
				var opt = depts[i];
				var el = document.createElement("option");
				// console.log(opt["dept"]);
				el.textContent = opt["dept"];
				el.value = opt["dept"];
				select.appendChild(el);
			}
		});
	</script>

	<!-- Populate course list -->
	<script type="text/javascript">
		$(selectDept).on('change', function() {
			$('#selectCourse').css('visibility', 'visible');
			$('#selectSection').css('visibility', 'hidden');
			$('#submitButton').css('visibility', 'hidden');
			$('#selectLab').css('display', 'none');
			$('#selectCourse').empty();
			$('#selectSection').empty();
			$('#selectLab').empty();
			var dept = $('#selectDept').val();
			$.get('http://trump6.com/schedulizeme/api/courses.php?dept=' + dept, function(data) {
				var courses = JSON.parse(data);
				var select = document.getElementById("selectCourse");
				var firstElement = document.createElement("option");
				firstElement.textContent = "Choose Course";
				firstElement.value = "";
				$(firstElement).attr('selected', 'selected');
				$(firstElement).attr('disabled', 'disabled');
				select.appendChild(firstElement);
				for(var i = 0; i < courses.length; i++) {
					var opt = courses[i];
					var el = document.createElement("option");
					el.textContent = opt["num"] + ' - ' + opt["title"];
					el.value = opt["num"];
					select.appendChild(el);
				}
			});
		});
	</script>
	
	<!-- Populate section list -->
	<script type="text/javascript">
		$(selectCourse).on('change', function() {
			$('#selectSection').css('visibility', 'visible');
			$('#selectLab').css('display', 'none');
			$('#submitButton').css('visibility', 'hidden');
			$('#selectSection').empty();
			$('#selectLab').empty();
			var dept = $('#selectDept').val();
			var course = $('#selectCourse').val();
			var extension = dept + '&courseNum=' + course;
			$.get('http://trump6.com/schedulizeme/api/sections.php?dept=' + extension, function(data) {
				var sections = JSON.parse(data);
				var select = document.getElementById("selectSection");
				var firstElement = document.createElement("option");
				firstElement.textContent = "Choose Section";
				firstElement.value = "";
				$(firstElement).attr('selected', 'selected');
				$(firstElement).attr('disabled', 'disabled');
				select.appendChild(firstElement);
				for (var i = 0; i < sections.length; i++) {
					var opt = sections[i];
					if (opt["credits"] != 0) {
						var el = document.createElement("option");
						el.textContent = opt["days"] + ': ' + opt["beginTime"] + ' - ' + opt["endTime"];
						el.value = opt["crn"] + opt["section"];
						select.appendChild(el);
					}
				}
			});
		});
	</script>

	<!-- Populate lab list -->
	<script type="text/javascript">
		$(selectSection).on('change', function() {
			$('#selectLab').empty();
			var dept = $('#selectDept').val();
			var course = $('#selectCourse').val();
			var extension = dept + '&courseNum=' + course;
			var section = $('#selectSection').val().substring(5,6);

			$.get('http://trump6.com/schedulizeme/api/sections.php?dept=' + extension, function(data) {

				var sections = JSON.parse(data);
				var select = document.getElementById("selectLab");

				var firstElement = document.createElement("option");
				firstElement.textContent = "Choose Lab";
				firstElement.value = "";
				$(firstElement).attr('selected', 'selected');
				$(firstElement).attr('disabled', 'disabled');
				select.appendChild(firstElement);

				var display = false;
				for (var i = 0; i < sections.length; i++) {
					var opt = sections[i];
					if (opt["credits"] == 0 && opt["section"].substring(0,1) == section) {
						display = true;
						var el = document.createElement("option");
						el.textContent = opt["days"] + ': ' + opt["beginTime"] + ' - ' + opt["endTime"];
						el.value = opt["crn"] + opt["section"];
						select.appendChild(el);
					}
				}
				if (display) {
					$('#selectLab').css('display', 'inline-block');
				} else {
					$('#submitButton').css('visibility', 'visible');
				}
			});			
		});
	</script>

	<!-- Display submit button after lab is picked -->
	<script type="text/javascript">
		$(selectLab).on('change', function() {
			$('#submitButton').css('visibility', 'visible');
		});
	</script>

	<!-- Send crn to php to add course to schedule -->
	<script type="text/javascript">
		$(submitButton).click(function() {
			var crnSection = $('#selectSection').val().substring(0,5);
			cookieAdd(crnSection);
			var crnLab = $('#selectLab').val();
			cookieAdd(crnLab);
			if (crnLab != null) {
				console.log(crnLab);
				crnLab = crnLab.substring(0,5);
			}
			var func = function(data) {
				var sections = JSON.parse(data)[0];
				var dept = sections["dept"];
				var courseNum = sections["num"];
				var crn = sections["crn"];
				var dayString = sections["days"];
				var days = [];
				var daysOfWeek = "MTWRFSU";
				for (i = 0; i < dayString.length; ++i) {
					days.push(daysOfWeek.indexOf(dayString[i]));
				}
				var location = sections["location"];
				var beginTimeNum = sections["beginTimeNum"];
				var endTimeNum = sections["endTimeNum"];
				var beginTime = sections["beginTime"];
				var endTime = sections["endTime"];

				addToCalendar(dept, courseNum, crn, days, location, beginTimeNum, endTimeNum, beginTime, endTime);
			}
			var group = $('#selectDept').val() + " " + $('#selectCourse').val();
			$('canvas').removeLayerGroup(group).drawLayers();

			console.log(group);
			$.get('http://trump6.com/schedulizeme/api/crn.php?crn=' + crnSection, func);
			if (crnLab != null) {
				$.get('http://trump6.com/schedulizeme/api/crn.php?crn=' + crnLab, func);
			}
		});
	</script>

	<!-- CREATE CANVAS -->
	<script src='jcanvas.js'></script>
	<div class = "calendar">
		<canvas width='1450' height='860'></canvas> <!-- DON'T FORGET TO CHANGE THIS SHIT -->
		<script type="text/javascript">
			// SIZE SETTINGS
			var calWidth = 1450, calHeight = 850;
			var dayWidth = 200;
			var hourHeight = 60;
      var separator = 5;
			var timeOffset = 50;
			
			// VERTICAL LINES
			for(var i = dayWidth+timeOffset; i < dayWidth*7; i+=dayWidth) {
				$('canvas').drawLine({
					layer: true,
					strokeStyle: '#bdc3c7',
					strokeWidth: 1,
					strokeDash: [1],
					x1: i, y1: calHeight-(13*hourHeight),
					x2: i, y2: calHeight,
				});
			}
			
			// DAYS OF THE WEEK
			var weekdays = ["Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday", "Sunday"];
			var dayPos = 100;
			for(var i = 0; i < 8; i++) {
				$('canvas').drawText({
					layer: true,
					fillStyle: '#6E6E6E',
					strokeStyle: '#6E6E6E',
					strokeWidth: 0.1,
					x: dayPos+timeOffset, y: 30,
					fontSize: 26,
					fontFamily: 'Open Sans, sans-serif',
					text: weekdays[i]
				});
				dayPos+=dayWidth;
			}

			// LITTLE HOURLY TICK MARK THINGS
			for(var i = calHeight-(13*hourHeight); i < calHeight + 1; i+=hourHeight) {
				for (var j = dayWidth + timeOffset; j < dayWidth*7; j+=dayWidth) {
					$('canvas').drawLine({
						layer: true,
						strokeStyle: '#bdc3c7',
						strokeWidth: 1,
						x1: j-4, y1: i,
						x2: j+4, y2: i
					});
				}
			}
			
			<!-- GRAY HALF-HOUR BOXES -->
			for(var i = calHeight-(13*hourHeight); i < calHeight; i+=hourHeight) {
				for (var j = timeOffset; j < dayWidth*7; j+=dayWidth) {
					$('canvas').drawRect({
						layer: true,
						fillStyle: '#F4F4F4',
						x: j, y: i,
						opacity: 0.5,
						fromCenter: false,
						width: dayWidth,
						height: hourHeight/2
					});
				}
			}
			
			<!-- TIMES -->
			var numberColor = "#bdc3c7";
			for(var i = 0; i < 14; i++) {
				var j = i+8+' ';
				if(j > 12) {
					j-=12;
					j += ' pm';
				} else {
					j += ' am';
				}
				$('canvas').drawText({
					layer: true,
					fillStyle: numberColor,
					strokeStyle: numberColor,
					strokeWidth: 0.1,
					x: 25, y: (i*hourHeight)+(calHeight-(13*hourHeight)),
					fontSize: 12,
					fontFamily: 'Segoe UI Light, sans-serif',
					text: j
				});
			}

			function addToCalendar(dept, courseNum, crn, days, location, beginTimeNum, endTimeNum, beginTime, endTime) {

				// POSSIBLE COLORS FOR CLASSES
				var colors = ["#e8efe8", "#faf1a2", "#ffe19b", "#e9d0e5", "#8ca4d4", "#bae3f7", "#c1e4dd", "#c5d9a6", "#e74c3c"];
				var color = Math.floor((Math.random() * 9));
				
				for (i = 0; i < days.length; ++i) {
					console.log(i + ' ' + dept + ' ' + courseNum);
					$('canvas').drawRect({
						layer: true,
						name: crn + days[i], // unique to this specific block
						groups: [dept + " " + courseNum, "courses"], // should be dept + num because thats unique to the group of courses when deleting an entire course
						fillStyle: colors[color],
						x: days[i] * dayWidth + separator + timeOffset, 
						y: (calHeight-(13*hourHeight)) + (beginTimeNum-480),
						fromCenter: false,
						width: dayWidth-separator*2,
						height: endTimeNum-beginTimeNum,
						cornerRadius: 3
					});
					$('canvas').drawText({
						layer: true,
						name: crn + days[i] + 'text',
						groups: [dept + " " + courseNum, "courses"],
						fillStyle: '#000',
						strokeWidth: 2,
						x: (days[i] * dayWidth) + (dayWidth/2) + timeOffset, 
						y: (calHeight-(13*hourHeight)) + (beginTimeNum-480) + ((endTimeNum-beginTimeNum)/2),
						fontSize: 14,
						fontFamily: 'Verdana, sans-serif',
						text: dept + ' ' + courseNum + '\n' + beginTime + ' - ' + endTime + '\n' + location
					});
				}
			}
		</script>


	<div>

</body>
</html>
